#!/usr/bin/env php
<?php

declare(strict_types=1);

require __DIR__ . '/../vendor/autoload.php';

use App\Factory\DogFactory;
use Docopt\ExitException;

$doc = <<<DOC
Dogs CLI.

Usage:
  dogs <breed> <action>
  dogs (-h | --help)

Arguments:
  <breed>   Dog breed (shiba-inu, mops, dachshund, plush-labrador, rubber-dachshund).
  <action>  Action to perform (sound|hunt).

Options:
  -h --help  Show this screen.
DOC;

try {
    $args = \Docopt::handle($doc);
} catch (ExitException $e) {
    fwrite(STDERR, $e->getMessage());
    exit($e->status);
}

$breed = (string) $args['<breed>'];
$action = (string) $args['<action>'];

try {
    $dog = DogFactory::create($breed);
} catch (\InvalidArgumentException $e) {
    fwrite(STDERR, $e->getMessage() . PHP_EOL);
    exit(1);
}

switch ($action) {
    case 'sound':
        $output = $dog->sound();
        break;
    case 'hunt':
        $output = $dog->hunt();
        break;
    default:
        fwrite(STDERR, "Unknown action: {$action}\n");
        exit(1);
}
echo $output . PHP_EOL;
